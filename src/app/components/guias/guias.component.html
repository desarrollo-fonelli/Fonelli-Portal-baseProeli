<!-- BOTON para mostrar o esconder Criterios de Filtro -->
<div class="container float-left">
  <p>
    <button type="button" class="btnFonelliAzul btn" (click)="collapse.toggle()" [attr.aria-expanded]="!isCollapsed"
      aria-controls="collapseExample">
      Filtros
    </button>
  </p>
</div>

<!-- Criterios de filtro -->
<div #collapse="ngbCollapse" class="container float-left" [(ngbCollapse)]="isCollapsed">
  <div class="card">
    <div class="card-body">
      <h2 class="card-title">Consulta de guías</h2>
      <!-- General Form Elements -->
      <form>
        <div class="form-row">
          <div class="form-group col-md-3">
            <label class="CamposFonelli">Desde Oficina</label>
            <input type="text" id="idOficinaDesde" class="form-control" name="idOficinaDesde" #nombre="ngModel"
              [(ngModel)]="oBuscar.OficinaDesde" />
          </div>
          <div class="form-group col-md-3">
            <label class="CamposFonelli">Hasta Oficina</label>
            <input type="text" id="idOficinaHasta" class="form-control" name="idOficinaHasta" #nombre="ngModel"
              [(ngModel)]="oBuscar.OficinaHasta" />
          </div>
        </div>
        <div class="form-row">
          <div class="form-group col-md-3">
            <label class="CamposFonelli">Cliente</label>
            <input type="text" id="idCliCod" class="form-control" name="idCliCod" #nombre="ngModel"
              [(ngModel)]="oBuscar.ClienteCodigo" disabled="{{ bCliente }}" required />
          </div>
          <div class="form-group col-md-3">
            <label class="CamposFonelli">Filial</label>
            <input type="text" id="idFilCli" class="form-control" name="idFilCli" #nombre="ngModel"
              [(ngModel)]="oBuscar.ClienteFilial" disabled="{{ bCliente }}" required />
          </div>
          <div class="form-group col-md-3" [hidden]="bCliente">
            <label class="CamposFonelli col-md-12" style="color: white">-</label>
            <button type="button" class="btnFonelli btn" (click)="openClientes(Clientes)"
              style="background-color: #24a4cc">
              <i class="bi bi-search"></i>
            </button>
          </div>
        </div>
        <div class="form-row">
          <div class="form-group col-md-3">
            <label class="CamposFonelli">Paquete</label>
            <input type="text" id="idPaquete" class="form-control" name="idPaquete" #nombre="ngModel"
              [(ngModel)]="oBuscar.Paquete" required />
          </div>
        </div>
        <div class="form-row">
          <div class="form-group col-md-3">
            <label class="CamposFonelli">Serie</label>
            <input type="text" id="idFactSerie" class="form-control" name="idFactSerie" #nombre="ngModel"
              [(ngModel)]="oBuscar.FactSerie" required />
          </div>
          <div class="form-group col-md-3">
            <label class="CamposFonelli">Factura</label>
            <input type="text" id="idFactura" class="form-control" name="idFactura" #nombre="ngModel"
              [(ngModel)]="oBuscar.Factura" required />
          </div>
          <div class="form-group col-md-3">
            <label class="CamposFonelli">Remision</label>
            <input type="text" id="idRemision" class="form-control" name="idRemision" #nombre="ngModel"
              [(ngModel)]="oBuscar.Remision" required />
          </div>
        </div>

        <div class="form-row">
          <div class="form-group col-md-3">
            <label class="CamposFonelli">Serie</label>
            <input type="text" id="idPrefaSerie" class="form-control" name="idPrefaSerie" #nombre="ngModel"
              [(ngModel)]="oBuscar.PrefaSerie" required />
          </div>
          <div class="form-group col-md-3">
            <label class="CamposFonelli">Prefactura</label>
            <input type="text" id="idPrefactura" class="form-control" name="idPrefactura" #nombre="ngModel"
              [(ngModel)]="oBuscar.Prefactura" required />
          </div>
          <div class="form-group col-md-3">
            <label class="CamposFonelli">Pedido</label>
            <input type="text" id="idPedido" class="form-control" name="idPedido" #nombre="ngModel"
              [(ngModel)]="oBuscar.Pedido" required />
          </div>
        </div>
        <div class="form-row">
          <div class="form-group col-md-3">
            <label class="CamposFonelli">Traspaso</label>
            <input type="text" id="idTraspaso" class="form-control" name="idTraspaso" #nombre="ngModel"
              [(ngModel)]="oBuscar.Traspaso" required />
          </div>
          <div class="form-group col-md-3">
            <label class="CamposFonelli">Orden Retorno</label>
            <input type="text" id="idOrdenRetorno" class="form-control" name="idOrdenRetorno" #nombre="ngModel"
              [(ngModel)]="oBuscar.OrdenRetorno" required />
          </div>
          <div class="form-group col-md-3">
            <label class="CamposFonelli">Orden Compra</label>
            <input type="text" id="idOrdenCompra" class="form-control" name="idOrdenCompra" #nombre="ngModel"
              [(ngModel)]="oBuscar.OrdenCompra" required />
          </div>
        </div>
        <div class="form-row">
          <div class="form-group col-md-3">
            <label class="CamposFonelli">Carrier</label>
            <input type="text" id="idCarrier" class="form-control" name="idOrdenCarrier" #nombre="ngModel"
              [(ngModel)]="oBuscar.Carrier" required />
          </div>
        </div>

        <div class="row">
          <div class="form-group col-md-2">
            <div class="form-check">
              <input class="form-check-input" type="radio" name="gridRadios" id="idClteCredito" value=1
                #nombre="ngModel" [(ngModel)]="oBuscar.ClteCredito" />
              <label class="form-check-label CamposFonelli" for="gridRadios">
                Cltes Crédito
              </label>
            </div>
          </div>
          <div class="form-group col-md-2">
            <div class="form-check">
              <input class="form-check-input" type="radio" name="gridRadios" id="idClteContado" value=2
                #nombre="ngModel" [(ngModel)]="oBuscar.ClteCredito" />
              <label class="form-check-label CamposFonelli" for="gridRadios">
                Cltes Contado</label>
            </div>
          </div>
          <div class="form-group col-md-2">
            <div class="form-check">
              <input class="form-check-input" type="radio" name="gridRadios" id="idClteTodos" value=3 #nombre="ngModel"
                [(ngModel)]="oBuscar.ClteCredito" />
              <label class="form-check-label CamposFonelli" for="gridRadios">
                Todos
              </label>
            </div>
          </div>
        </div>

        <div *ngIf="sMensaje">
          <p class="alert alert-danger" role="alert">{{ sMensaje }}</p>
        </div>

        <div class="form-row">
          <div class="form-group col-md-6">
            <button type="submit" (click)="consultaGuias()" class="btnFonelli btn">
              <span *ngIf="bCargando" class="spinner-border spinner-border-sm" role="status" aria-hidden="true"
                style="color: #183e6f">
              </span>
              BUSCAR
            </button>
          </div>
        </div>
      </form>
      <!-- End General Form Elements -->
    </div>
  </div>
</div>

<!-- Header de la form que muestra los datos recuperados -->
<div class="container float-left" [hidden]="!bBandera">
  <br>
  <h4 style="text-align: center; font-size:xx-large;">Número
    {{oGuiaRes.Contenido.ClienteCodigo}}-{{oGuiaRes.Contenido.ClienteFilial}} {{oGuiaRes.Contenido.ClienteNombre}}</h4>
  <div class="container">
    <div class="form-row">
      <!-- <div class="form-group col-md-1">              
      <label class="CamposFonelli">Pedido:</label>
    </div>
    <div class="form-group col-md-5">              
      <input
          type="text"
          class="form-control"
          [(ngModel)]="searchtext"
          placeholder="Search"                 
        />
      </div> -->
      <div class="form-group col-md-12">
        <button class="btnImprimir btn float-right" (click)="downloadAsPDF()">
          Imprimir PDF
        </button>
      </div>
    </div>
  </div>

  <!-- Tabla que muestra los datos recuperados
       (tambien se usa para "pdfTable" -->
  <div class="container" id="pdfTable" #pdfTable>
    <table class="table table-hover table-striped" datatable [dtOptions]="dtOptions" [dtTrigger]="dtTrigger">
      <thead class="thead-p">

        <tr *ngIf="bBanderaTipo" class="EncTabla">
          <th style="background-color: #24a4cc; color: white;" scope="col">#</th>
          <th style="background-color: #24a4cc; color: white; " scope="col">Paquete</th>
          <th style="background-color: #24a4cc; color: white; text-align: center;" scope="col">
            <div class="size">FechaPaq</div>
          </th>
          <th style="background-color: #24a4cc; color: white;" scope="col">Oficina</th>
          <th style="background-color: #24a4cc; color: white; " scope="col">SeriePref</th>
          <th style="background-color: #24a4cc; color: white; " scope="col">Prefactura</th>
          <th style="background-color: #24a4cc; color: white; " scope="col">Serie</th>
          <th style="background-color: #24a4cc; color: white; " scope="col">Fact/Rem</th>
          <th style="background-color: #24a4cc; color: white; " scope="col">OrdenComp</th>
          <th style="background-color: #24a4cc; color: white; " scope="col">Traspaso</th>
          <th style="background-color: #24a4cc; color: white; " scope="col">OrdenReto</th>
          <th style="background-color: #24a4cc; color: white; text-align:right;" scope="col">Piezas</th>
          <th style="background-color: #24a4cc; color: white; text-align:right;" scope="col">Gramos</th>
          <th style="background-color: #24a4cc; color: white; text-align:right;" scope="col">Importe</th>
          <th style="background-color: #24a4cc; color: white; text-align: center;" scope="col">
            <div class="size">FechaExpe</div>
          </th>
          <th style="background-color: #24a4cc; color: white; text-align: center;" scope="col">
            <div class="size">Carrier</div>
          </th>
          <th style="background-color: #24a4cc; color: white; " scope="col">CarrierNom</th>
          <th style="background-color: #24a4cc; color: white; text-align: left;" scope="col">
            <div class="size">Guia</div>
          </th>
          <th style="background-color: #24a4cc; color: white; text-align: center;" scope="col">
            <div class="size">Stat</div>
          </th>
          <th style="background-color: #24a4cc; color: white; text-align: center;" scope="col">
            <div class="size">FechaRece</div>
          </th>
          <th style="background-color: #24a4cc; color: white; text-align:left;">Observac</th>
          <th style="background-color: #24a4cc; color: white;">L</th>
          <th style="background-color: #24a4cc; color: white; text-align:left;">Pedido</th>
          <th style="background-color: #24a4cc; color: white; text-align:right;" scope="col">Cliente</th>
          <th style="background-color: #24a4cc; color: white; text-align:right;" scope="col">Filial</th>
        </tr>

        <tr *ngIf="!bBanderaTipo" class="EncTabla">
          <!-- por ahora estoy dejando igual el layout en ambos casos -->
          <th style="background-color: #24a4cc; color: white;" scope="col">#</th>
          <th style="background-color: #24a4cc; color: white; " scope="col">Paquete</th>
          <th style="background-color: #24a4cc; color: white; text-align: center;" scope="col">
            <div class="size">FechaPaq</div>
          </th>
          <th style="background-color: #24a4cc; color: white;" scope="col">Oficina</th>
          <th style="background-color: #24a4cc; color: white; text-align:center;" scope="col">SeriePref</th>
          <th style="background-color: #24a4cc; color: white; " scope="col">Prefactura</th>
          <th style="background-color: #24a4cc; color: white; text-align:center;" scope="col">Serie</th>
          <th style="background-color: #24a4cc; color: white; " scope="col">Fact/Rem</th>
          <th style="background-color: #24a4cc; color: white; " scope="col">OrdenComp</th>
          <th style="background-color: #24a4cc; color: white; " scope="col">Traspaso</th>
          <th style="background-color: #24a4cc; color: white; " scope="col">OrdenReto</th>
          <th style="background-color: #24a4cc; color: white; text-align:right;" scope="col">Piezas</th>
          <th style="background-color: #24a4cc; color: white; text-align:right;" scope="col">Gramos</th>
          <th style="background-color: #24a4cc; color: white; text-align:right;" scope="col">Importe</th>
          <th style="background-color: #24a4cc; color: white; text-align:center;" scope="col">
            <div class="size">FechaExpe</div>
          </th>
          <th style="background-color: #24a4cc; color: white; text-align: center;" scope="col">
            <div class="size">Carrier</div>
          </th>
          <th style="background-color: #24a4cc; color: white; " scope="col">CarrierNom</th>
          <th style="background-color: #24a4cc; color: white; text-align: left;" scope="col">
            <div class="size">Guia</div>
          </th>
          <th style="background-color: #24a4cc; color: white; text-align: center;" scope="col">
            <div class="size">Stat</div>
          </th>
          <th style="background-color: #24a4cc; color: white; text-align: center;" scope="col">
            <div class="size">FechaRece</div>
          </th>
          <th style="background-color: #24a4cc; color: white; text-align:left;">Observac</th>
          <th style="background-color: #24a4cc; color: white;">L</th>
          <th style="background-color: #24a4cc; color: white; text-align:left;">Pedido</th>
          <th style="background-color: #24a4cc; color: white; text-align:right;" scope="col">Cliente</th>
          <th style="background-color: #24a4cc; color: white; text-align:right;" scope="col">Filial</th>
        </tr>

      </thead>
      <tbody>
        <!-- <tr *ngFor="let ped of guias ; index as i" (click)="openPedidoDetalle(PedidoDetalle,ped.Pedido)"> -->
        <tr *ngFor="let gui of guia ; index as i">
          <th scope="row" (click)="openDetalleGuia(PedidoDetalle,gui.Guia)">{{ i + 1 }}</th>
          <td class="FilasFonelli" style="text-align:left" (click)="openDetalleGuia(PedidoDetalle,gui.Guia)">{{
            gui.Paquete}}</td>
          <td class="FilasFonelli" style="text-align:left">{{ gui.FechaPaq}}</td>
          <td class="FilasFonelli" style="text-align:center"> {{gui.Oficina}} </td>
          <td class="FilasFonelli" style="text-align:center"> {{gui.SeriePref}} </td>
          <td class="FilasFonelli" (click)="openDetalleGuia(PedidoDetalle,gui.Guia)">{{ gui.Prefactura}} </td>
          <td class="FilasFonelli" style="text-align:center"> {{gui.Serie}} </td>
          <td class="FilasFonelli" (click)="openDetalleGuia(PedidoDetalle,gui.Guia)">{{ gui.Factura}} </td>
          <td class="FilasFonelli"> {{gui.OrdenComp}} </td>
          <td class="FilasFonelli"> {{gui.Traspaso}} </td>
          <td class="FilasFonelli"> {{gui.OrdenReto}} </td>
          <td class="FilasFonelli" style="text-align:right">{{ gui.Piezas}}</td>
          <td class="FilasFonelli" style="text-align:right">{{ gui.Gramos}}</td>
          <td class="FilasFonelli" style="text-align:right">{{ gui.Importe}}</td>
          <td class="FilasFonelli">{{ gui.FechaExpe}}</td>
          <td class="FilasFonelli" style="text-align:center">{{ gui.Carrier}}</td>
          <td class="FilasFonelli" style="white-space: nowrap;min-width: 20;">{{ gui.CarrierNom}}</td>
          <!--
          <td *ngIf="bBanderaTipo" class="FilasFonelli" style="text-align:left"> <u><a class="nav-link"
                [attr.href]="oBuscar.Carrier" target="_blank">{{ gui.NumeroGuia}}</a></u></td>
          -->
          <td class="FilasFonelli" style="text-align:left;white-space: nowrap;min-width: 20;">{{ gui.Guia}}</td>
          <td class="FilasFonelli" style="text-align:center">{{ gui.Stat}}</td>
          <td class="FilasFonelli" style="text-align:left">{{ gui.FechaRece}}</td>
          <td class="FilasFonelli" style="white-space:nowrap;min-width: 40ch;">{{ gui.Observac}}</td>
          <td class="FilasFonelli" style="text-align:center;">{{ gui.Letra}}</td>
          <td class="FilasFonelli"> {{gui.Pedido}} </td>
          <td class="FilasFonelli" style="text-align:right">{{ gui.Cliente}}</td>
          <td class="FilasFonelli" style="text-align:right">{{ gui.Filial}}</td>
        </tr>
        <!-- <tr>
                <th ></th>
                <td ></td>
                <td ></td>
                <td ></td>
                <td ></td>
                <td ></td>
                <td ></td>                
                <td class="FilasFonelli" style="text-align:left">Total General</td>
                <td class="FilasFonelli" style="text-align:right">{{ oPedidoRes.Contenido.CantidadPedida}}</td> 
                <td class="FilasFonelli" style="text-align:right">{{ oPedidoRes.Contenido.CantidadPedida - oPedidoRes.Contenido.DiferenciaPedidosSurtido}}</td> 
                <td class="FilasFonelli" style="text-align:right">{{ oPedidoRes.Contenido.DiferenciaPedidosSurtido}}</td>
              </tr> -->
      </tbody>
    </table>

  </div>

  <!-- </div>  -->

  <!--Modal pedidos detalle-->
  <ng-template #PedidoDetalle let-modal>
    <div class="modal-header">
      <button type="button" class="btn-close" aria-label="Close" (click)="modal.dismiss('Cross click')"></button>
    </div>

    <div class="modal-body-tables" style="overflow-y: scroll;">

      <div class="container">
        <div class="row">
          <div>
            <label>Numero de cliente: <strong>{{oBuscar.ClienteCodigo+'-'+oBuscar.ClienteFilial}}
                {{obtenNombreCliente(oBuscar.ClienteCodigo, oBuscar.ClienteFilial)}}</strong></label>
            <br>
            <label> Pedido: <strong>{{oBuscaDetalle.PedidoFolio}}</strong> </label>
          </div>

          <!-- <div class="form-row">
                  <div class="form-group col-md-12">
                      <button  *ngIf="bBanderaBtnPro" type="submit" (click)="verDetalleProd()" class="btnFonelli btn float-right">Detalle producción</button>
                      <button  *ngIf="bBanderaBtnPed" type="submit" (click)="verDetallePed()" class="btnFonelli btn float-right">Detalle pedido</button>
                  </div>
                </div>  -->
          <div class="col-12">
            <table *ngIf="bBanderaDet" class="table table-striped">
              <thead class="thead-p2">
                <tr class="EncTabla">
                  <th>#</th>
                  <th scope="col" style="text-align:left">LN</th>
                  <th scope="col" style="text-align:left">
                    <div class="size">CLAVE</div>
                  </th>
                  <th scope="col" style="text-align:left">DESCRIPCIÓN</th>
                  <th scope="col" style="text-align:center;">
                    <div class="size">FECHA PED</div>
                  </th>
                  <th scope="col" style="text-align:right">CANT/PEDIDO</th>
                  <th scope="col" style="text-align:right">GRAMOS/PED</th>
                  <th scope="col" style="text-align:center">
                    <div class="size">FEC/SUR</div>
                  </th>
                  <th scope="col" style="text-align:right">CAN/SURT</th>
                  <th scope="col" style="text-align:left">GRA/SURT</th>
                  <th scope="col" style="text-align:left">ESTATUS</th>
                </tr>
              </thead>
              <tbody>
                <tr *ngFor="let pedDet of pedidoDet; index as i">
                  <th scope="row">{{ i + 1 }}</th>
                  <td class="FilasFonelli" style="text-align:left">{{ pedDet.Linea}}</td>
                  <td class="FilasFonelli" style="text-align:left"> <u>{{pedDet.Clave}}</u> </td>
                  <td class="FilasFonelli" style="text-align:left">{{ pedDet.Descripcion}}</td>
                  <td class="FilasFonelli" style="text-align:left">{{ pedDet.FechaPedido}}</td>
                  <td class="FilasFonelli" style="text-align:left">{{ pedDet.CantidadPedido}}</td>
                  <td class="FilasFonelli" style="text-align:right">{{ pedDet.GramoPedido}}</td>
                  <td class="FilasFonelli" style="text-align:left">{{ pedDet.FechaSurtido}}</td>
                  <td class="FilasFonelli" style="text-align:right">{{ pedDet.CantidadSurtido}}</td>
                  <td class="FilasFonelli" style="text-align:left">{{ pedDet.GramosSurtidos}}</td>
                  <td class="FilasFonelli" style="text-align:left">{{ pedDet.Estatus}}</td>
                </tr>
                <!-- <tr>
                            <th></th>
                            <td></td>
                            <td></td>
                            <td></td>
                            <td></td>
                            <td></td> 
                            <td class="FilasFonelli" style="text-align:right; color: #183e6f;">Totales</td>
                            <td class="FilasFonelli" style="text-align:right; color: #183e6f;">{{oPedidoDetalleRes.Contenido.CantidadPedida }}</td> 
                            <td></td> 
                            <td class="FilasFonelli" style="text-align:right; color: #183e6f;">{{oPedidoDetalleRes.Contenido.CantidadSurtida }}</td> 
                             <td class="FilasFonelli" style="text-align:right; color: #183e6f;">{{ getTotalPedido(pedidoDet,'CantidadPedida')}}</td> 
                          </tr> -->
              </tbody>
            </table>
          </div>
        </div>
      </div>
    </div>

    <!-- <div *ngIf="alerLoginDistribuidor">
        <p class="alert alert-danger" role="alert">{{respuestaLoginDistribuidor}}</p>
      </div> -->
  </ng-template>

  <!--Modal catalogo clientes-->
  <ng-template #Clientes let-modal>
    <div class="modal-header">
      <button type="button" class="btn-close" aria-label="Close" (click)="modal.dismiss('Cross click')"></button>
    </div>

    <div class="modal-body-tables" style="overflow-y: scroll;">

      <div class="container">
        <div class="row">

          <div class="form-group col-md-1">
            <br>
            <label class="CamposFonelli">Buscar:</label>
          </div>
          <div class="form-group col-md-5">
            <br>
            <input type="text" class="form-control" [(ngModel)]="searchtext" placeholder="Search" />
          </div>


          <div class="col-12">
            <table class="table table-striped">
              <thead class="thead-p2">
                <tr class="EncTabla">
                  <th>#</th>
                  <th scope="col"></th>
                  <th scope="col">NUM</th>
                  <th scope="col">FIL</th>
                  <th scope="col">RAZÓN SOCIAL</th>
                  <th scope="col">SUCURSAL/NOMBRE</th>
                  <th scope="col">S</th>
                  <th scope="col">CONTACTO1</th>
                  <th scope="col">CONTACTO2</th>
                </tr>
              </thead>
              <tbody>
                <td *ngIf="bCargandoClientes" class="FilasFonelli" style="text-align:center" colspan="10"><span
                    class="spinner-border spinner-border-sm" role="status" aria-hidden="true" style="color:#183e6f">
                  </span></td>
                <tr *ngFor="let emp of oCliente.Contenido |searchconsultaCliente: searchtext; index as i"
                  (click)="obtenCliente(emp.ClienteCodigo,emp.ClienteFilial)">
                  <th scope="row">{{ i + 1 }}</th>
                  <td>
                    <input style="border-color: #24a4cc;" type="checkbox">
                  </td>
                  <td class="FilasFonelli" style="text-align:left">{{emp.ClienteCodigo}}</td>
                  <td class="FilasFonelli" style="text-align:left">{{emp.ClienteFilial}}</td>
                  <td class="FilasFonelli" style="text-align:left">{{emp.RazonSocial}}</td>
                  <td class="FilasFonelli" style="text-align:left">{{emp.DatosGenerales.Sucursal}}</td>
                  <td class="FilasFonelli" style="text-align:left">{{emp.DatosGenerales.Status}}</td>
                  <td class="FilasFonelli" style="text-align:left">{{emp.Contactos.Contacto1Nombre}}</td>
                  <td class="FilasFonelli" style="text-align:left">{{emp.Contactos.Contacto2Nombre}}</td>
                </tr>
              </tbody>
            </table>

          </div>
        </div>

      </div>
    </div>


    <div class="modal-footer">
      <!-- <button type="submit" class="btn btn-primary" [disabled]="!formLoginDistribuidor.form.valid">INGRESAR</button> -->

    </div>

  </ng-template>